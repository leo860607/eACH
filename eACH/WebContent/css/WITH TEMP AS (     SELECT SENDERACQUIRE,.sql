WITH TEMP AS (     SELECT SENDERACQUIRE, OUTACQUIRE, INACQUIRE, SENDERHEAD, OUTHEAD, INHEAD, RESULTSTATUS, TIMEOUTCODE, SENDERSTATUS, DT_REQ_1, ACCTCODE     FROM VW_ONBLOCKTAB     WHERE  CLEARINGPHASE = '01'  AND  BIZDATE = '20200407' ) SELECT A.BANKID || '-' || COALESCE(A.BANKNAME,'') AS BANKID, COALESCE((SELECT (CASE WHEN MBSYSSTATUS='1' THEN '開機' WHEN MBSYSSTATUS='2' THEN '押碼基碼同步' WHEN MBSYSSTATUS='3' THEN '訊息通知' WHEN MBSYSSTATUS='9' THEN '關機' ELSE 'NA' END) FROM BANKSYSSTATUSTAB WHERE BGBK_ID=A.BANKID), '') MEMBANKSSYSTS, COALESCE((SELECT (CASE WHEN MBAPSTATUS='1' THEN '簽到' WHEN MBAPSTATUS='2' THEN '暫時簽退' WHEN MBAPSTATUS='9' THEN '簽退'  ELSE 'NA' END ) FROM BANKAPSTATUSTAB WHERE BGBK_ID=A.BANKID AND APID='2000'), '') MEMBANKAPPSTS, (SELECT COUNT(*) FROM TEMP WHERE SENDERACQUIRE = A.BANKID AND RESULTSTATUS = 'A') FIRE_SUCCESS_COUNT, (SELECT COUNT(*) FROM TEMP WHERE SENDERACQUIRE = A.BANKID AND RESULTSTATUS = 'R') FIRE_FAIL_COUNT, (SELECT COUNT(*) FROM TEMP WHERE OUTACQUIRE = A.BANKID AND RESULTSTATUS = 'A') OUT_SUCCESS_COUNT, (SELECT COUNT(*) FROM TEMP WHERE OUTACQUIRE = A.BANKID AND RESULTSTATUS = 'R') OUT_FAIL_COUNT, (SELECT COUNT(*) FROM TEMP WHERE INACQUIRE = A.BANKID AND RESULTSTATUS = 'A') IN_SUCCESS_COUNT, (SELECT COUNT(*) FROM TEMP WHERE INACQUIRE = A.BANKID AND RESULTSTATUS = 'R') IN_FAIL_COUNT, (SELECT COUNT(*) FROM TEMP WHERE (SENDERACQUIRE = A.BANKID OR OUTACQUIRE = A.BANKID OR INACQUIRE = A.BANKID) AND LENGTH(TIMEOUTCODE) > 0) TIMEOUTCOUNT, (SELECT COUNT(*) FROM TEMP WHERE (SENDERACQUIRE = A.BANKID OR OUTACQUIRE = A.BANKID OR INACQUIRE = A.BANKID) AND COALESCE(RESULTSTATUS,'P') = 'P') PENDTCOUNT_1, (SELECT COUNT(*) FROM TEMP WHERE (SENDERACQUIRE = A.BANKID OR OUTACQUIRE = A.BANKID OR INACQUIRE = A.BANKID) AND RESULTSTATUS='P' AND SENDERSTATUS <> '1' AND ACCTCODE='0') ACCTCOUNT, (SELECT COUNT(*) FROM TEMP WHERE (SENDERACQUIRE = A.BANKID OR OUTACQUIRE = A.BANKID OR INACQUIRE = A.BANKID) AND RESULTSTATUS='P' AND SENDERSTATUS = '1') PENDTCOUNT_2, (SELECT COUNT(*) FROM TEMP WHERE (SENDERACQUIRE = A.BANKID OR OUTACQUIRE = A.BANKID OR INACQUIRE = A.BANKID) AND COALESCE(DT_REQ_1,'') <> '' AND LENGTH(COALESCE(TIMEOUTCODE,'')) = 0) TOTALCOUNT, COALESCE((SELECT REST_CR_LINE FROM CR_LINE WHERE BANK_ID=A.BANKID), 0) REST_CR_LINE FROM (     SELECT BG.OPBK_ID AS BANKID, OP.BGBK_NAME AS BANKNAME     FROM BANK_GROUP BG JOIN BANK_GROUP OP ON BG.OPBK_ID = OP.BGBK_ID     WHERE  RTRIM(COALESCE(OP.ACTIVE_DATE,'')) <> ''     AND '01090407' BETWEEN OP.ACTIVE_DATE AND (CASE RTRIM(COALESCE(OP.STOP_DATE,'')) WHEN '' THEN '01991231' ELSE OP.STOP_DATE END)     AND BG.BGBK_ATTR <> '6'     GROUP BY BG.OPBK_ID, OP.BGBK_NAME ORDER BY BG.OPBK_ID ) AS A  ORDER BY BANKID ASC
